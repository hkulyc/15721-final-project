# this file contains C++ code templates for passing queries to DuckDB to handle
macro: |-
  #include <stdexcept>


global: |-
  thread_local duckdb::Connection trans_con({db_name});\n
  thread_local std::unique_ptr<duckdb::PreparedStatement> {function_name}_prepare = trans_con.Prepare("SELECT {query_formatter}");

function_call: |-
  {return_type} {function_name}({function_args}){
      auto res = prepare->Execute({prepare_args});
      if(!res->HasError())
          return res->Fetch()->GetValue(0,0).GetValue<{return_type}>();
      else
          throw std::runtime_error("Error when waiting for query result.");
  }